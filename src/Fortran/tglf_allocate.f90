      SUBROUTINE tglf_allocate
!
! allocate internal modules
!
!-------------------------------------------------
      USE tglf_dimensions
      USE tglf_species
      USE tglf_coeff
      IMPLICIT NONE
!
!      write(*,*)"allocate",ns,nbasis,nx,nky
!
!     MODULE tglf_species 
! 
! species parameters
!
      ALLOCATE(ei_exch(ns,ns))
      ALLOCATE(resist(ns,ns))
      ALLOCATE(zs(ns))
      ALLOCATE(mass(ns))
      ALLOCATE(vs(ns))
      ALLOCATE(fts(ns))
      ALLOCATE(rlts(ns))
      ALLOCATE(rlns(ns))
      ALLOCATE(vpar_shear_s(ns))
      ALLOCATE(as(ns))
      ALLOCATE(taus(ns))
      ALLOCATE(vpar_s(ns))         
!
!
!-------------------------------------------------
!
!      MODULE tglf_coeff
!
! store the hermite basis matrix coefficients
!
! ave_h
      ALLOCATE(ave_hn(ns,nbasis,nbasis))
      ALLOCATE(ave_hp1(ns,nbasis,nbasis))
      ALLOCATE(ave_hp3(ns,nbasis,nbasis))
      ALLOCATE(ave_hr11(ns,nbasis,nbasis))
      ALLOCATE(ave_hr13(ns,nbasis,nbasis))
      ALLOCATE(ave_hr33(ns,nbasis,nbasis))
      ALLOCATE(ave_hw113(ns,nbasis,nbasis))
      ALLOCATE(ave_hw133(ns,nbasis,nbasis))
      ALLOCATE(ave_hw333(ns,nbasis,nbasis))
      ALLOCATE(ave_ht1(ns,nbasis,nbasis))
      ALLOCATE(ave_ht3(ns,nbasis,nbasis))
      ALLOCATE(ave_hu1(ns,nbasis,nbasis))
      ALLOCATE(ave_hu3(ns,nbasis,nbasis))
      ALLOCATE(ave_hu33(ns,nbasis,nbasis))
      ALLOCATE(ave_hu3ht1(ns,nbasis,nbasis))
      ALLOCATE(ave_hu3ht3(ns,nbasis,nbasis))
      ALLOCATE(ave_hu33ht1(ns,nbasis,nbasis))
      ALLOCATE(ave_hu33ht3(ns,nbasis,nbasis))
      ALLOCATE(ave_hninv(ns,nbasis,nbasis))
      ALLOCATE(ave_hp1inv(ns,nbasis,nbasis))
      ALLOCATE(ave_hp3inv(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhp1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhr11(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhr13(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhp1p1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhr11p1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhr13p1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhu1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhu3(ns,nbasis,nbasis))
      ALLOCATE(ave_hnp0(ns,nbasis,nbasis))
      ALLOCATE(ave_hp1p0(ns,nbasis,nbasis))
      ALLOCATE(ave_hp3p0(ns,nbasis,nbasis))
      ALLOCATE(ave_hr11p0(ns,nbasis,nbasis))
      ALLOCATE(ave_hr13p0(ns,nbasis,nbasis))
      ALLOCATE(ave_hr33p0(ns,nbasis,nbasis))
      ALLOCATE(ave_hnb0(ns,nbasis,nbasis))
      ALLOCATE(ave_hp1b0(ns,nbasis,nbasis))
      ALLOCATE(ave_hp3b0(ns,nbasis,nbasis))
      ALLOCATE(ave_hr11b0(ns,nbasis,nbasis))
      ALLOCATE(ave_hr13b0(ns,nbasis,nbasis))
      ALLOCATE(ave_hr33b0(ns,nbasis,nbasis))
      ALLOCATE(ave_hw113b0(ns,nbasis,nbasis))
      ALLOCATE(ave_hw133b0(ns,nbasis,nbasis))
      ALLOCATE(ave_hw333b0(ns,nbasis,nbasis))
      ALLOCATE(ave_hnbp(ns,nbasis,nbasis))
      ALLOCATE(ave_hp1bp(ns,nbasis,nbasis))
      ALLOCATE(ave_hp3bp(ns,nbasis,nbasis))
      ALLOCATE(ave_hr11bp(ns,nbasis,nbasis))
      ALLOCATE(ave_hr13bp(ns,nbasis,nbasis))
      ALLOCATE(ave_hr33bp(ns,nbasis,nbasis))
      ALLOCATE(ave_hw113bp(ns,nbasis,nbasis))
      ALLOCATE(ave_hw133bp(ns,nbasis,nbasis))
      ALLOCATE(ave_hw333bp(ns,nbasis,nbasis))
      ALLOCATE(ave_hnp0b0(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhp1p0(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhr11p0(ns,nbasis,nbasis))
      ALLOCATE(ave_gradhr13p0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhu3ht1(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhu3ht3(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhu33ht1(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhu33ht3(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdhu3(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdhu33(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdhu3ht1(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdhu3ht3(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdhu33ht1(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdhu33ht3(ns,nbasis,nbasis))
      ALLOCATE(ave_c_tor_par_hp1p0(ns,nbasis,nbasis))
      ALLOCATE(ave_c_tor_par_hr11p0(ns,nbasis,nbasis))
      ALLOCATE(ave_c_tor_par_hr13p0(ns,nbasis,nbasis))
! ave_g
      ALLOCATE(ave_gn(ns,nbasis,nbasis))
      ALLOCATE(ave_gp1(ns,nbasis,nbasis))
      ALLOCATE(ave_gp3(ns,nbasis,nbasis))
      ALLOCATE(ave_gr11(ns,nbasis,nbasis))
      ALLOCATE(ave_gr13(ns,nbasis,nbasis))
      ALLOCATE(ave_gr33(ns,nbasis,nbasis))
      ALLOCATE(ave_gw113(ns,nbasis,nbasis))
      ALLOCATE(ave_gw133(ns,nbasis,nbasis))
      ALLOCATE(ave_gw333(ns,nbasis,nbasis))
      ALLOCATE(ave_gt1(ns,nbasis,nbasis))
      ALLOCATE(ave_gt3(ns,nbasis,nbasis))
      ALLOCATE(ave_gu1(ns,nbasis,nbasis))
      ALLOCATE(ave_gu3(ns,nbasis,nbasis))
      ALLOCATE(ave_gu33(ns,nbasis,nbasis))
      ALLOCATE(ave_gu3gt1(ns,nbasis,nbasis))
      ALLOCATE(ave_gu3gt3(ns,nbasis,nbasis))
      ALLOCATE(ave_gu33gt1(ns,nbasis,nbasis))
      ALLOCATE(ave_gu33gt3(ns,nbasis,nbasis))
      ALLOCATE(ave_gninv(ns,nbasis,nbasis))
      ALLOCATE(ave_gp1inv(ns,nbasis,nbasis))
      ALLOCATE(ave_gp3inv(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgp1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgr11(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgr13(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgp1p1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgr11p1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgr13p1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgu1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgu3(ns,nbasis,nbasis))
      ALLOCATE(ave_gnp0(ns,nbasis,nbasis))
      ALLOCATE(ave_gp1p0(ns,nbasis,nbasis))
      ALLOCATE(ave_gp3p0(ns,nbasis,nbasis))
      ALLOCATE(ave_gr11p0(ns,nbasis,nbasis))
      ALLOCATE(ave_gr13p0(ns,nbasis,nbasis))
      ALLOCATE(ave_gr33p0(ns,nbasis,nbasis))
      ALLOCATE(ave_gnb0(ns,nbasis,nbasis))
      ALLOCATE(ave_gp1b0(ns,nbasis,nbasis))
      ALLOCATE(ave_gp3b0(ns,nbasis,nbasis))
      ALLOCATE(ave_gr11b0(ns,nbasis,nbasis))
      ALLOCATE(ave_gr13b0(ns,nbasis,nbasis))
      ALLOCATE(ave_gr33b0(ns,nbasis,nbasis))
      ALLOCATE(ave_gw113b0(ns,nbasis,nbasis))
      ALLOCATE(ave_gw133b0(ns,nbasis,nbasis))
      ALLOCATE(ave_gw333b0(ns,nbasis,nbasis))
      ALLOCATE(ave_gnbp(ns,nbasis,nbasis))
      ALLOCATE(ave_gp1bp(ns,nbasis,nbasis))
      ALLOCATE(ave_gp3bp(ns,nbasis,nbasis))
      ALLOCATE(ave_gr11bp(ns,nbasis,nbasis))
      ALLOCATE(ave_gr13bp(ns,nbasis,nbasis))
      ALLOCATE(ave_gr33bp(ns,nbasis,nbasis))
      ALLOCATE(ave_gw113bp(ns,nbasis,nbasis))
      ALLOCATE(ave_gw133bp(ns,nbasis,nbasis))
      ALLOCATE(ave_gw333bp(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgp1p0(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgr11p0(ns,nbasis,nbasis))
      ALLOCATE(ave_gradgr13p0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgu3gt1(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgu3gt3(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgu33gt1(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgu33gt3(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdgu3(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdgu33(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdgu3gt1(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdgu3gt3(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdgu33gt1(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdgu33gt3(ns,nbasis,nbasis))
      ALLOCATE(ave_c_tor_par_gp1p0(ns,nbasis,nbasis))
      ALLOCATE(ave_c_tor_par_gr11p0(ns,nbasis,nbasis))
      ALLOCATE(ave_c_tor_par_gr13p0(ns,nbasis,nbasis))
! ave_wd_h
      ALLOCATE(ave_wdhp1p0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhr11p0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhr13p0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhp1b0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhr11b0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhr13b0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhp1bp(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhr11bp(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhr13bp(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhu1(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhu3(ns,nbasis,nbasis))
      ALLOCATE(ave_wdhu33(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdhu1(ns,nbasis,nbasis))
      ALLOCATE(ave_wdht1(ns,nbasis,nbasis))
      ALLOCATE(ave_wdht3(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdht1(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdht3(ns,nbasis,nbasis))
! ave_wd_g
      ALLOCATE(ave_wdgp1p0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgr11p0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgr13p0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgp1b0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgr11b0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgr13b0(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgp1bp(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgr11bp(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgr13bp(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgu1(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgu3(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgu33(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdgu1(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgt1(ns,nbasis,nbasis))
      ALLOCATE(ave_wdgt3(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdgt1(ns,nbasis,nbasis))
      ALLOCATE(ave_modwdgt3(ns,nbasis,nbasis))
! kpar_h
      ALLOCATE(ave_kparhnp0(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhp1p0(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhp3p0(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhp1b0(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhr11b0(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhr13b0(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhnbp(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhp3bp(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhp1bp(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhr11bp(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhr13bp(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhu1(ns,nbasis,nbasis))
      ALLOCATE(ave_kparhu3(ns,nbasis,nbasis))
      ALLOCATE(ave_kparht1(ns,nbasis,nbasis))
      ALLOCATE(ave_kparht3(ns,nbasis,nbasis))
      ALLOCATE(ave_modkparhu1(ns,nbasis,nbasis))
      ALLOCATE(ave_modkparhu3(ns,nbasis,nbasis))
! kpar_g
      ALLOCATE(ave_kpargnp0(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargp1p0(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargp3p0(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargp1b0(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargr11b0(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargr13b0(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargnbp(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargp3bp(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargp1bp(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargr11bp(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargr13bp(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargu1(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargu3(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargt1(ns,nbasis,nbasis))
      ALLOCATE(ave_kpargt3(ns,nbasis,nbasis))
      ALLOCATE(ave_modkpargu1(ns,nbasis,nbasis))
      ALLOCATE(ave_modkpargu3(ns,nbasis,nbasis))
! gradB_h
      ALLOCATE(ave_gradBhp1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBhp3(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBhr11(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBhr13(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBhr33(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBhu1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBhu3(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBhu33(ns,nbasis,nbasis))
! gradB_g
      ALLOCATE(ave_gradBgp1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBgp3(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBgr11(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBgr13(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBgr33(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBgu1(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBgu3(ns,nbasis,nbasis))
      ALLOCATE(ave_gradBgu33(ns,nbasis,nbasis))
!  ave_theta
      ALLOCATE(ave_kx(nbasis,nbasis))
      ALLOCATE(ave_c_tor_par(nbasis,nbasis))
      ALLOCATE(ave_c_tor_per(nbasis,nbasis))
      ALLOCATE(ave_c_par_par(nbasis,nbasis))
      ALLOCATE(ave_wdh(nbasis,nbasis))
      ALLOCATE(ave_wdg(nbasis,nbasis))
      ALLOCATE(ave_modwdh(nbasis,nbasis))
      ALLOCATE(ave_modwdg(nbasis,nbasis))
      ALLOCATE(ave_gradB(nbasis,nbasis))
      ALLOCATE(ave_lnB(nbasis,nbasis))
      ALLOCATE(ave_b0(nbasis,nbasis))
      ALLOCATE(ave_b0inv(nbasis,nbasis))
      ALLOCATE(ave_kpar(nbasis,nbasis))
      ALLOCATE(ave_modkpar(nbasis,nbasis))
      ALLOCATE(ave_p0(nbasis,nbasis))
      ALLOCATE(ave_p0inv(nbasis,nbasis))
      ALLOCATE(ave_bp(nbasis,nbasis))
      ALLOCATE(ave_bpinv(nbasis,nbasis))
      ALLOCATE(ave_kpar_eff(ns,nbasis,nbasis))
      ALLOCATE(ave_modkpar_eff(ns,nbasis,nbasis))
!
      END SUBROUTINE tglf_allocate
!-----------------------------------------------------
!
